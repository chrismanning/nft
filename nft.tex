\documentclass[a4paper]{article}
\usepackage[a4paper]{geometry}
\usepackage{listings}
\lstset{language=C}
\usepackage{biblatex}
\usepackage{array}
\bibliography{rfc,misc}

%opening
\title{CTEC3604 -- Multi-service Networks\\
Network File Transfer Application}
\author{Christian Manning}

\begin{document}

\maketitle

\tableofcontents

\pagebreak

\section{Introduction}

The aim of this project is to create an application which utilises TCP to transfer files over a network. The application is required to use Berkeley sockets and a client-server architecture.

\section{Similar Applications}

This section contains the evaluations of similar applications or protocols in an attempt to gather the needed requirements for this project.

\subsection{File Transfer Protocol (FTP)}

\textit{FTP} \cite{rfc959} is a protocol specifically designed for the transfer of files using TCP. It uses a client-server architecture. For each client connected to the server, there is a control connection which is initiated by connecting to a pre-specified port (default 21). This control connection is the means by which commands are send from the client to the server, and replies are sent from the server to a client. This is achieved using the \textit{Telnet} protocol \cite{rfc854}. Each client is usually maintained in a separate thread.

When a command sent by the client requires data in reply, another connection is established specifically for data transfers, from the data port (default 20). Because of it using multiple ports, \textit{FTP} is known as an out-of-band protocol. This data can be text or binary data and can be sent in blocks, as a stream or compressed.

\textit{FTP} requires clients to login with a username and password, though the username may be 'anonymous' if the server is configured to allow anonymous access. The client then has the same access and permissions as that of the user they are logged in. The transferred data, commands and replies themselves are not encrypted in any way.

The client can provide a shell-like command line interface with which the user enters commands and text replies are shown, or a graphical user interface (GUI). Some commands are as follows: LIST (list directory entries), CWD (change working directory), DELE (delete file), RETR (transfer file), et al. These commands allow the user to browse the remote file system so that the available files can become known.

\subsection{Secure Copy (SCP)}

\textit{SCP} is a secure network equivalent of the common \textit{cp} (file copy) shell command. It uses the \textit{SSH} \cite{rfc4253} protocol, though provides no shell access, only the transferral of files. Because of it being based on \textit{SSH} it is very secure as all network communications undertaken by \textit{SCP} are encrypted. Its simple interface limits its usefulness to situations where only a simple copy is needed from one host to another. The remote file systems cannot be browsed as with \textit{FTP}, requiring knowledge from the user of the file system layout if the file is destined for anywhere other than the users remote home directory.

The security features of this application are one of its primary benefits, but they are beyond the scope of this project.

\subsection{rsync}

\textit{rsync} is an application intended to replace \textit{SCP} with a focus on synchronising files and directories across computers, which makes it a popular backup tool. It does this by comparing the checksums (or sometimes the modification date) of files on both hosts and if they differ, the transfer is initiated. Its interface is similar to that of \textit{SCP} and is highly script-able. \textit{rsync} can operate in daemon mode by listening on its default TCP port of 873, or it can operate using \textit{SSH} requiring the \textit{rsync} client to be on both hosts. Daemon mode is generally used for the purpose of mirroring servers, minimising data transfers for the server.

While \textit{rsync} is more featureful than \textit{SCP}, it still doesn't have the ability to browse the remote file system like \textit{FTP}, requiring an alternate application (eg.\ \textit{SSH}) for this functionality.

\section{Functional Requirements}

The following requirements were realised from determining which of the above existing applications' features were suitable for this project and combining some.

\begin{itemize}
 \item Client-server architecture.
 \item Shell-like user interface.
 \item Ability to browse the file system client and server-side, i.e.\ change working directory, list files, get file size, etc.
 \item Transfer files from the server to the client, and vice versa.
 \item Separate control connection and data connection. Use the data connection for binary data only; the control connection can accept textual replies.
 \item Maintain each client in its own thread.
\end{itemize}

\section{Implementation}

Both the server and client were implemented using the D programming language \cite{dlang} using the standard library with no external libraries. Version 2.058 of the compiler, runtime and standard library was used throughout the implementation of this project.

\section{Testing}

This section will show tests of one of the major features listed above: the file transfers themselves. The tests have been carried out over a Gigabit Ethernet LAN with both the client and server hosts running GNU/Linux. These tests will demonstrate the applications reliability in this situation and will also show its error handling capabilities. All files used are randomly generated.

$C$ denotes the client, $S$ denotes the server, $\rightarrow$ or $\leftarrow$ denotes direction of transfer. The files used in these tests are identified by their size.\\
\begin{tabular}{|m{0.15cm}| m{3cm} | m{2.5cm} | m{7.2cm} |}
\hline
 \# & Test  & Expected Result & Actual Result \\ \hline
 1 & 100MB file $S \rightarrow C$ & MD5 checksums match &
  \begin{tabular}{r@{: }l}
  original & 8ddeb39c79c6429d684bd69a3c18a692 \\
  got & 8ddeb39c79c6429d684bd69a3c18a692 \\
  \end{tabular}
 \\ \hline
 2 & 1000MB file $S \rightarrow C$ & MD5 checksums match &
  \begin{tabular}{r@{: }l}
  original & 845087542715041a9241c07764c5bfb0 \\
  got & 845087542715041a9241c07764c5bfb0 \\
  \end{tabular} \\ \hline
 3 & 4.5GB file $S \rightarrow C$ & MD5 checksums match &
  \begin{tabular}{r@{: }l}
  original & 6faa2c90b333573cc040cede7203592e \\
  got & 6faa2c90b333573cc040cede7203592e \\
  \end{tabular} \\ \hline
 4 & 200MB file $C \rightarrow S$ & MD5 checksums match &
  \begin{tabular}{r@{: }l}
  original & 08c2a37ef2bfa7c529a8d0071e64f9c0 \\
  got & 08c2a37ef2bfa7c529a8d0071e64f9c0 \\
  \end{tabular}
 \\ \hline
 5 & 2000MB file $C \rightarrow S$ & MD5 checksums match &
  \begin{tabular}{r@{: }l}
  original & 2963e7928261f9c7dd3386c86f73a330 \\
  got & 2963e7928261f9c7dd3386c86f73a330 \\
  \end{tabular} \\ \hline
 6 & 3.5GB file $C \rightarrow S$ & MD5 checksums match &
  \begin{tabular}{r@{: }l}
  original & d1acc5f957330dfdfedac7ab152d3937 \\
  got & d1acc5f957330dfdfedac7ab152d3937 \\
  \end{tabular} \\ \hline
 7 & User interrupt on client during transfer (ctrl-c) & Server safely stops operations on client & Server safely stops operations on client. Server messages detailed below. \\ \hline
 8 & Remove the Ethernet cable during transfer & TCP connection will eventually time out & TCP connection times out after 10+ minutes. If the cable is reconnected in this time, the transfer resumes successfully. \\ \hline
\end{tabular}\\

The following messages are produced by the server instance during test number 7, accompanied by some short explanations.\begin{description}
 \item [A network error occurred] Transfer stops.
 \item [Sending reply...] Tries to send the last reply in the buffer. No exception is thrown.
 \item [Waiting for command...] The call to receive returns 0. A DisconnectException is thrown based on this error code.
 \item [192.168.0.3:42481 disconnected] DisconnectException is caught and handled, printing its message.
 \item [Client thread ending] Client thread safely ending.
 \item [Removing socket. No. clients: 0] Client control socket removed and the client count is updated.
\end{description}


\section{Evaluation}

\printbibliography
\end{document}
